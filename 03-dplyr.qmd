---
title: "Section 3: `dplyr`"
author: "Matt Higham"
format: 
  html:
    embed-resources: true
---

```{r}
library(babynames)
library(tidyverse)
```

## Class Exercises 

Class Exercise 1 and 2.

```{r}
babynames_m17 <- babynames |>
  filter(sex == "M" & year == 2017) |>
  arrange(desc(n)) |>
  slice(1:10)

ggplot(data = babynames_m17, aes(x = name, y = n)) +
  geom_col()

babynames_peter <- babynames |>
  filter(name == "Peter" & sex == "M")

ggplot(data = babynames_peter, aes(x = year, y = n)) +
  geom_line()
```

Class Exercise 5.

We cannot use the pipe with `mean()` because the first argument to the mean function is __not__ a data frame. 

fitness_df |> summarise(mean_val = mean(distance))

## Your Turn

Your Turn 1

```{r}
## a
babynames |> filter(year != 1945)

## b
babynames |> filter(n > 400 & n < 5000)

## c
babynames_mc <- babynames |>
  filter((name == "Hilary" & sex == "F") |
                      (name == "Monica" & sex == "F"))
babynames_mc
```

Your Turn 2

```{r}
ggplot(data = babynames_mc, aes(x = year, y = n)) +
  geom_line(aes(colour = name))
```

Your Turn 3

```{r}
babynames_5 <- babynames |> filter((name == "Matthew" & sex == "M") |
                      (name == "Robin" & sex == "M") |
                      (name == "Jessica" & sex == "F") |
                      (name == "Michael" & sex == "M") |
                      (name == "Ivan" & sex == "M"))
ggplot(data = babynames_5, aes(x = year, y = n)) +
  geom_line(aes(colour = name))
```

Your Turn 4

```{r}
babynames_02m <- babynames |>
  filter(year == 2002 & sex == "M") |>
  arrange(desc(n)) |>
  slice(1:10)

ggplot(data = babynames_02m, aes(x = name, y = prop)) +
  geom_col()
```

## Section 3.3

```{r}
library(tidyverse)
slumajors_df <- read_csv("https://raw.githubusercontent.com/highamm/ds234_quarto/main/data_online/SLU_Majors_17_21.csv")
slumajors_df

slumajors_df <- slumajors_df |>
  mutate(ntotal = nfemales + nmales) |>
  mutate(percfemale = 100 * nfemales / (nfemales + nmales))

slumajors_df <- slumajors_df |>
  mutate(morewomen = if_else(percfemale > 50,
                             true = "Yes",
                             false = "No")) |>
  mutate(large_majority =
           case_when(percfemale >= 70 ~ "female",
                     percfemale <= 30 ~ "male",
                     percfemale > 30 & percfemale < 70 ~ "none"))

toy_df <- tibble(x = c(NA, 3, 4, 7),
                 y = c(1, 4, 3, 2),
                 z = c("A", "A", "B", NA))
```

## Class Exercises

Class Exercise 1.

It depends on what you're interested in. But, if you're more interested in gender imbalance, 55% might make more sense as the cutoff.

Class Exercise 2. 

It's nice to be as inclusive as possible. But, we should carefully consider what is truly "anonymous" when we make public results from a survey.

Class Exercise 4.

```{r}
library(babynames)
babynames |> group_by(sex, year)
```

